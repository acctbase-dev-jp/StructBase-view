<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>SaaS利用開始｜委託先管理・個人情報保護 要件DB</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                   "Hiragino Kaku Gothic ProN", "Hiragino Sans",
                   "Noto Sans JP", Meiryo, sans-serif;
      background-color: #f3f4f6;
      color: #111827;
    }

    .container {
      max-width: 1100px;
      margin: 48px auto;
      padding: 56px 64px;
      background-color: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.08);
    }

    .back {
      display: inline-block;
      margin-bottom: 16px;
      color: #111827;
      text-decoration: none;
      font-size: 16px;
      font-weight: 600;
    }

    .back:hover {
      text-decoration: underline;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 24px;
    }

    .divider {
      border-bottom: 1px solid #e5e7eb;
      margin: 32px 0;
    }

    p {
      font-size: 18px;
      line-height: 1.8;
      margin-bottom: 16px;
    }

    /* ★ ここから枠UI調整（主変更点） */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 32px;
      font-size: 16px;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      overflow: hidden;
      background-color: #ffffff;
    }

    thead th {
      background-color: #f9fafb;
      font-weight: 600;
      text-align: left;
      padding: 14px 16px;
      border-bottom: 1px solid #e5e7eb;
      border-right: 1px solid #e5e7eb;
    }

    thead th:last-child {
      border-right: none;
    }

    tbody td {
      padding: 18px 16px;
      vertical-align: top;
      border-bottom: 1px solid #e5e7eb;
      border-right: 1px solid #e5e7eb;
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    tbody td:last-child {
      border-right: none;
    }
    /* ★ ここまで */

    .req-cell {
      position: relative;
    }

    .req-anchor {
      display: block;
      width: 1px;
      height: 1px;
      opacity: 0;
      position: relative;
      top: -1px;
    }

    .copy-link {
      position: absolute;
      top: 6px;
      left: 8px;
      font-size: 10px;
      color: #d1d5db;
      cursor: pointer;
      user-select: none;
      text-decoration: none;
      transition: color 0.2s;
      pointer-events: auto;
      z-index: 1;
    }

    .copy-link:hover {
      color: #6b7280;
    }

    .copy-link.copied {
      color: #111827;
    }

    .btn-link {
      display: inline-block;
      padding: 10px 18px;
      border: 1px solid #d1d5db;
      border-radius: 9999px;
      text-decoration: none;
      color: #2563eb;
      font-size: 14px;
      white-space: nowrap;
    }

    .note {
      margin-top: 40px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
      font-size: 14px;
      color: #4b5563;
      line-height: 1.7;
    }
  </style>
</head>

<body>
  <div class="container">

    <a class="back" href="../index.html">← 一覧に戻る</a>

    <h1>SaaS利用開始</h1>

    <p>
      本ページは、SaaS利用開始に関連して制度上確認が求められる事項と、
      それらの根拠となる法令・手続を整理した要件一覧です。
    </p>

    <div class="divider"></div>

    <table>
      <thead>
        <tr>
          <th>要件（確認が求められている事項）</th>
          <th>根拠（名称 / 箇所）</th>
          <th>参照URL（一次情報）</th>
        </tr>
      </thead>
      <tbody>
        <tr data-req-id="REQ-SAAS-001">
          <td class="req-cell"><span id="REQ-SAAS-001" class="req-anchor"></span>SaaS利用に伴い委託に該当するか否かを確認するための情報整理を行う</td>
          <td>個人情報保護法 / 第27条</td>
          <td><a class="btn-link" href="https://elaws.e-gov.go.jp/document?lawid=415AC0000000057" target="_blank">一次情報を開く</a></td>
        </tr>
        <tr data-req-id="REQ-SAAS-002">
          <td class="req-cell"><span id="REQ-SAAS-002" class="req-anchor"></span>SaaS提供事業者における個人データの取扱い有無を確認する</td>
          <td>個人情報保護法 / 第27条</td>
          <td><a class="btn-link" href="https://elaws.e-gov.go.jp/document?lawid=415AC0000000057" target="_blank">一次情報を開く</a></td>
        </tr>
        <tr data-req-id="REQ-SAAS-003">
          <td class="req-cell"><span id="REQ-SAAS-003" class="req-anchor"></span>委託先における安全管理措置の内容について確認が求められている事項を把握する</td>
          <td>個人情報保護法ガイドライン（通則編） / 第11章</td>
          <td><a class="btn-link" href="https://www.ppc.go.jp/personalinfo/legal/guidelines_tsusoku/" target="_blank">一次情報を開く</a></td>
        </tr>
        <tr data-req-id="REQ-SAAS-004">
          <td class="req-cell"><span id="REQ-SAAS-004" class="req-anchor"></span>個人データの取扱いに関する事項を契約内容に含める必要がある事項を把握する</td>
          <td>個人情報保護法 / 第27条</td>
          <td><a class="btn-link" href="https://elaws.e-gov.go.jp/document?lawid=415AC0000000057" target="_blank">一次情報を開く</a></td>
        </tr>
        <tr data-req-id="REQ-SAAS-005">
          <td class="req-cell"><span id="REQ-SAAS-005" class="req-anchor"></span>委託先に対する監督が求められている事項を把握する</td>
          <td>個人情報保護法 / 第27条</td>
          <td><a class="btn-link" href="https://elaws.e-gov.go.jp/document?lawid=415AC0000000057" target="_blank">一次情報を開く</a></td>
        </tr>
      </tbody>
    </table>

    <div class="note">
      ※ 本サイトは、判断・解釈・助言・推奨を提供するものではありません。<br />
         実務上の判断および対応は、事業者または専門家の責任において行ってください。
      <br /><br />
      ※ 各データベースは特定の範囲・観点に基づいて構成されており、
      網羅性・最新性・完全性を保証するものではありません。
    </div>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const reqRows = document.querySelectorAll('tbody tr[data-req-id^="REQ-"]');
      
      reqRows.forEach(function(row) {
        const reqId = row.getAttribute('data-req-id');
        const reqCell = row.querySelector('.req-cell');
        
        if (!reqCell) return;
        
        // コピーリンクを追加
        const copyLink = document.createElement('span');
        copyLink.className = 'copy-link';
        copyLink.textContent = 'copy';
        reqCell.appendChild(copyLink);
        
        // クリックイベント
        copyLink.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          // 要件セルをcloneしてcopy要素だけ除去
          const clonedCell = reqCell.cloneNode(true);
          const copyElement = clonedCell.querySelector('.copy-link');
          if (copyElement) {
            copyElement.remove();
          }
          const reqText = clonedCell.textContent.trim();
          
          // パーマリンク生成の厳格化：row.idをそのまま使用（加工禁止）
          const base = window.location.href.split('#')[0];
          const permalink = base + '#' + reqId;
          
          // コピーするテキスト
          const copyText = '参照: StructBase | requirement_id: ' + reqId + ' | ' + reqText + ' | ' + permalink;
          
          // クリップボードにコピー
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(copyText).then(function() {
              showCopyFeedback(copyLink);
            }).catch(function() {
              fallbackCopy(copyText, copyLink);
            });
          } else {
            fallbackCopy(copyText, copyLink);
          }
        });
      });
      
      // アンカー遷移の確実化（保険処理）
      function scrollToAnchor() {
        const targetId = decodeURIComponent(window.location.hash).replace(/^#/, '');
        if (!targetId) {
          return;
        }
        
        let scrollTarget = null;
        
        // まず document.getElementById(targetId) を探す
        const el = document.getElementById(targetId);
        if (el) {
          // el.closest('tr') があるならそれを scrollTarget にする（最優先）
          const tr = el.closest('tr');
          if (tr) {
            scrollTarget = tr;
          } else {
            // なければ el.closest('td') があるならそれを scrollTarget にする
            const td = el.closest('td');
            if (td) {
              scrollTarget = td;
            } else {
              // それも無ければ el を scrollTarget にする
              scrollTarget = el;
            }
          }
        } else {
          // id が見つからない場合は、tr[data-req-id="TARGET"] を探す
          const row = document.querySelector(`tr[data-req-id="${targetId}"]`);
          if (row) {
            scrollTarget = row;
          }
        }
        
        // スクロール実行
        if (scrollTarget) {
          scrollTarget.scrollIntoView({ block: 'start' });
        }
      }
      
      // リトライ付きスクロール実行
      function executeScrollWithRetry() {
        scrollToAnchor();
        setTimeout(function() {
          scrollToAnchor();
        }, 50);
        setTimeout(function() {
          scrollToAnchor();
        }, 200);
      }
      
      // load イベントで実行（3回リトライ）
      window.addEventListener('load', function() {
        executeScrollWithRetry();
      });
      
      // hashchange でも同じ処理を実行
      window.addEventListener('hashchange', function() {
        executeScrollWithRetry();
      });
      
      function fallbackCopy(text, element) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand('copy');
          showCopyFeedback(element);
        } catch (err) {
          console.error('コピーに失敗しました:', err);
        }
        document.body.removeChild(textarea);
      }
      
      function showCopyFeedback(element) {
        element.classList.add('copied');
        setTimeout(function() {
          element.classList.remove('copied');
        }, 800);
      }
    });
  </script>
</body>
</html>
